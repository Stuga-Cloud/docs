"use strict";(self.webpackChunkstuga_cloud_docs=self.webpackChunkstuga_cloud_docs||[]).push([[997],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),u=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(r),m=a,f=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return r?n.createElement(f,i(i({ref:t},c),{},{components:r})):n.createElement(f,i({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=r[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},8194:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var n=r(7462),a=(r(7294),r(3905));const o={sidebar_position:1,id:"build-a-function",title:"Build a function"},i=void 0,l={unversionedId:"services/lambdas/getting-started/build-a-function",id:"services/lambdas/getting-started/build-a-function",title:"Build a function",description:"Pr\xe9requis",source:"@site/docs/services/lambdas/getting-started/build-a-function.md",sourceDirName:"services/lambdas/getting-started",slug:"/services/lambdas/getting-started/build-a-function",permalink:"/docs/docs/services/lambdas/getting-started/build-a-function",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,id:"build-a-function",title:"Build a function"},sidebar:"docsSidebar",previous:{title:"Introduction",permalink:"/docs/docs/services/lambdas/introduction"},next:{title:"Run your function",permalink:"/docs/docs/services/lambdas/getting-started/run-your-function"}},s={},u=[{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Cr\xe9er votre premier lambda en Node.js",id:"cr\xe9er-votre-premier-lambda-en-nodejs",level:2},{value:"Cr\xe9er votre projet ou repartez du projet d&#39;exemple",id:"cr\xe9er-votre-projet-ou-repartez-du-projet-dexemple",level:3},{value:"Cr\xe9er votre projet",id:"cr\xe9er-votre-projet",level:4},{value:"Partez du starter d&#39;exemple",id:"partez-du-starter-dexemple",level:4},{value:"Cr\xe9er votre fonction",id:"cr\xe9er-votre-fonction",level:3},{value:"Cr\xe9er votre Dockerfile",id:"cr\xe9er-votre-dockerfile",level:3},{value:"Ce qu&#39;on a \xe0 ce point",id:"ce-quon-a-\xe0-ce-point",level:3},{value:"Build your function to a container image",id:"build-your-function-to-a-container-image",level:2},{value:"Conclusion",id:"conclusion",level:2}],c={toc:u},d="wrapper";function p(e){let{components:t,...r}=e;return(0,a.kt)(d,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"pr\xe9requis"},"Pr\xe9requis"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Docker install\xe9 sur votre machine")),(0,a.kt)("h2",{id:"cr\xe9er-votre-premier-lambda-en-nodejs"},"Cr\xe9er votre premier lambda en Node.js"),(0,a.kt)("h3",{id:"cr\xe9er-votre-projet-ou-repartez-du-projet-dexemple"},"Cr\xe9er votre projet ou repartez du projet d'exemple"),(0,a.kt)("h4",{id:"cr\xe9er-votre-projet"},"Cr\xe9er votre projet"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir mon-projet-lambda\ncd mon-projet-lambda\nnpm init -y\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ensuite changez le type de votre projet dans le package.json vers module")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "project-example",\n  "version": "1.0.0",\n  "description": "",\n  "main": "index.js",\n  "type": "module",\n  "scripts": {\n    "test": "echo \\"Error: no test specified\\" && exit 1"\n  },\n  "author": "",\n  "license": "ISC",\n  "dependencies": {\n    "axios": "^1.4.0"\n  }\n}\n\n')),(0,a.kt)("h4",{id:"partez-du-starter-dexemple"},"Partez du starter d'exemple"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"git clone git@github.com:Stuga-Cloud/faas-node-starter.git\ncd faas-node-starter\ncd {in the starter folder that you choosed}\n")),(0,a.kt)("h3",{id:"cr\xe9er-votre-fonction"},"Cr\xe9er votre fonction"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Il est important de savoir que tous les arguments sont pass\xe9s sous la forme d'un json stringifi\xe9 donc il est utile de la parser pour pouvoir l'utiliser."),(0,a.kt)("li",{parentName:"ul"},"Le retour doit contenir un statusCode et un body qui sera retourn\xe9 \xe0 l'utilisateur. Le body sera le corps de la r\xe9ponse et le statusCode le code de retour de la requ\xeate, ici une 200."),(0,a.kt)("li",{parentName:"ul"},"veillez \xe0 bien retourn\xe9 toujours ce format de retour m\xeame lors d'erreur il faudra les catch pour en retourner une sous cette forme."),(0,a.kt)("li",{parentName:"ul"},"la fonction doit \xeatre export\xe9 dans le fichier index.js")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"export const handler = async (argsParam) => {\n  const args = JSON.parse(argsParam);\n  return JSON.stringify({\n    statusCode: 200,\n    body: {\n      message: 'Hello World',\n    },\n  });\n};\n")),(0,a.kt)("h3",{id:"cr\xe9er-votre-dockerfile"},"Cr\xe9er votre Dockerfile"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ici il est important tout soit copi\xe9 dans le dossier /root"),(0,a.kt)("li",{parentName:"ul"},"vous pouvez modifier l'entrypoint de votre image ainsi que son CMD mais cela n'est pas conseill\xe9, en effet nous l'utilisons pour lancer votre fonction"),(0,a.kt)("li",{parentName:"ul"},"vous devez obligatoirement repartir d'une des image server mis \xe0 votre disposition pour cr\xe9er votre image")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},"FROM remymach/faas-node-16-server:1.0.0\n\nCOPY package*.json ./\nRUN npm install\nCOPY index.js /root/index.js\n")),(0,a.kt)("p",null,"| ",(0,a.kt)("strong",{parentName:"p"},"Et voila votre fonction est pr\xeate \xe0 \xeatre d\xe9ploy\xe9e sur Stuga Cloud ! Ah non mince il va encore falloir build cette image.")),(0,a.kt)("h3",{id:"ce-quon-a-\xe0-ce-point"},"Ce qu'on a \xe0 ce point"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"package.json")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "my-first-lambda",\n  "version": "1.0.0",\n  "description": "",\n  "type": "module",\n  "main": "index.js",\n  "scripts": {\n    "test": "echo \\"Error: no test specified\\" && exit 1"\n  },\n  "author": "",\n  "license": "ISC"\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"package-lock.json (g\xe9n\xe9r\xe9 par le npm i)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"index.js"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"export const handler = async (argsParam) => {\n  const args = JSON.parse(argsParam);\n  return JSON.stringify({\n    statusCode: 200,\n    body: {\n      message: 'Hello World',\n    },\n  });\n};\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Dockerfile")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},"FROM remymach/faas-node-16-server:1.0.0\n\nCOPY package*.json ./\nRUN npm install\nCOPY index.js /root/index.js\n")),(0,a.kt)("h2",{id:"build-your-function-to-a-container-image"},"Build your function to a container image"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Notice that you can use our lambda with arm and amd64 architecture in development but in ",(0,a.kt)("strong",{parentName:"li"},"production you have to build to amd64 architecture")),(0,a.kt)("li",{parentName:"ul"},"placez vous \xe0 la racine de votre fonction"),(0,a.kt)("li",{parentName:"ul"},"build your image",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"simple build",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t my-first-lambda .\n"))),(0,a.kt)("li",{parentName:"ul"},"complete build",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker buildx build --platform linux/amd64,linux/arm64,linux/arm/v7 -t my-first-lambda .\n"))))),(0,a.kt)("li",{parentName:"ul"},"push your image to a docker hub registry or stugaCloud registry")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker tag my-first-lambda:latest registry-machavoine.fr/{namespaceCreated}/my-first-lambda:1.0.0\nOR\ndocker tag my-first-lambda:latest {usernameDockerHub}/my-first-lambda:1.0.0\n\ndocker push registry-machavoine.fr/{namespaceCreated}/my-first-lambda:1.0.0\nOR\ndocker push my-first-lambda:latest {usernameDockerHub}/my-first-lambda:1.0.0\n")),(0,a.kt)("h2",{id:"conclusion"},"Conclusion"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Vous avez maintenant votre premi\xe8re fonction pr\xeate \xe0 \xeatre d\xe9ploy\xe9e sur Stuga Cloud et accessible via un registry docker.")))}p.isMDXComponent=!0}}]);